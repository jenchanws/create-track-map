/*
 * Leaflet.curve v0.1.0 - a plugin for Leaflet mapping library. https://github.com/elfalem/Leaflet.curve
 * (c) elfalem 2015
 */
L.Curve=L.Path.extend({options:{},initialize:function(t,o){L.setOptions(this,o),this._setPath(t)},getPath:function(){return this._coords},setPath:function(t){return this._setPath(t),this.redraw()},getBounds:function(){return this._bounds},_setPath:function(t){this._coords=t,this._bounds=this._computeBounds()},_computeBounds:function(){for(var t,o,n=new L.LatLngBounds,e=0;e<this._coords.length;e++)if(coord=this._coords[e],"string"==typeof coord||coord instanceof String)o=coord;else if("H"==o)n.extend([t.lat,coord[0]]),t=new L.latLng(t.lat,coord[0]);else if("V"==o)n.extend([coord[0],t.lng]),t=new L.latLng(coord[0],t.lng);else if("C"==o){var r=new L.latLng(coord[0],coord[1]);coord=this._coords[++e];var i=new L.latLng(coord[0],coord[1]);coord=this._coords[++e];var c=new L.latLng(coord[0],coord[1]);n.extend(r),n.extend(i),n.extend(c),c.controlPoint1=r,c.controlPoint2=i,t=c}else if("S"==o){i=new L.latLng(coord[0],coord[1]);coord=this._coords[++e];c=new L.latLng(coord[0],coord[1]),r=t;if(t.controlPoint2){var s=t.lat-t.controlPoint2.lat,d=t.lng-t.controlPoint2.lng;r=new L.latLng(t.lat+s,t.lng+d)}n.extend(r),n.extend(i),n.extend(c),c.controlPoint1=r,c.controlPoint2=i,t=c}else if("Q"==o){var a=new L.latLng(coord[0],coord[1]);coord=this._coords[++e];c=new L.latLng(coord[0],coord[1]);n.extend(a),n.extend(c),c.controlPoint=a,t=c}else if("T"==o){c=new L.latLng(coord[0],coord[1]),a=t;if(t.controlPoint){s=t.lat-t.controlPoint.lat,d=t.lng-t.controlPoint.lng;a=new L.latLng(t.lat+s,t.lng+d)}n.extend(a),n.extend(c),c.controlPoint=a,t=c}else n.extend(coord),t=new L.latLng(coord[0],coord[1]);return n},getCenter:function(){return this._bounds.getCenter()},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updatecurve(this)},_project:function(){var t,o,n,e;this._points=[];for(var r=0;r<this._coords.length;r++)if("string"==typeof(t=this._coords[r])||t instanceof String)this._points.push(t),n=t;else{switch(t.length){case 2:e=this._map.latLngToLayerPoint(t),o=t;break;case 1:"H"==n?(e=this._map.latLngToLayerPoint([o[0],t[0]]),o=[o[0],t[0]]):(e=this._map.latLngToLayerPoint([t[0],o[1]]),o=[t[0],o[1]])}this._points.push(e)}}}),L.curve=function(t,o){return new L.Curve(t,o)},L.SVG.include({_updatecurve:function(t){this._setPath(t,this._curvePointsToPath(t._points))},_curvePointsToPath:function(t){for(var o,n,e="",r=0;r<t.length;r++)if("string"==typeof(o=t[r])||o instanceof String)e+=n=o;else switch(n){case"H":e+=o.x+" ";break;case"V":e+=o.y+" ";break;default:e+=o.x+","+o.y+" "}return e||"M0 0"}});